{"filename":"anti-bloat.md","filepath":"docs/usage/guides/bundler","hash":42,"frontmatter":{"title":"Anti Bloat"},"text":"\nimport Alert from '@theme/Alert'\n\nThe following links have tutorials on reducing the size of your installers:\n\n- https://github.com/RazrFalcon/cargo-bloat\n- https://lifthrasiir.github.io/rustlog/why-is-a-rust-executable-large.html\n- https://doc.rust-lang.org/cargo/reference/manifest.html#the-profile-sections\n\n### Rust Compression Features\n\nAdd this to your `src-tauri/Cargo.toml`\n\n    [profile.release]\n    panic = \"abort\"\n    codegen-units = 1\n    lto = true\n    incremental = false\n    opt-level = \"s\"\n\n<Alert title=\"Note\">\n\nThere is also `opt-level = \"z\"` available to try to reduce the resulting binary size. `\"s\"` and `\"z\"` can sometimes be smaller than the other, so test it with your own application!\n\nWe've seen smaller binary sizes from `\"s\"` for Tauri example applications, but real world applications can always differ.\n</Alert>\n\n#### Unstable Rust Compression Features\n\n<Alert type=\"warning\" title=\"Warning\" icon=\"alert\">\nThe following suggestions are all unstable features and require a nightly toolchain. See the <a href=\"https://doc.rust-lang.org/cargo/reference/unstable.html#unstable-features\">Unstable Features</a> documentation for more information of what this involves.\n</Alert>\n\nThe following methods involve using unstable compiler features and require having a rust nightly toolchain installed. If you don't have the nightly toolchain + `rust-src` nightly component added, try the following:\n\n    $ rustup toolchain install nightly\n    $ rustup component add rust-src --toolchain nightly\n\nThe Rust Standard Library comes precompiled. You can instead apply the optimization options used for the rest of your binary + dependencies to the std with an unstable flag. This flag requires specifying your target, so know the target triple that you are targeting.\n\n    $ cargo +nightly build --release -Z build-std --target x86_64-unknown-linux-gnu\n\nIf you are using `panic = \"abort\"` in your release profile optimizations, then you need to make sure the `panic_abort` crate is compiled with std. Additionally, an extra std feature can be used to further reduce the binary size. The following applies both:\n\n    $ cargo +nightly build --release -Z build-std=std,panic_abort -Z build-std-features=panic_immediate_abort --target x86_64-unknown-linux-gnu\n\nSee the unstable documentation for more details about [`-Z build-std`](https://doc.rust-lang.org/cargo/reference/unstable.html#build-std) and [`-Z build-std-features`](https://doc.rust-lang.org/cargo/reference/unstable.html#build-std-features).\n\n### Stripping\n\nBinary size can easily be reduced by stripping out debugging information from binaries that ship to end users. This is not good for debuggable builds, but means good binary size savings for end user binaries. The easiest way is to use the famous `strip` utility to remove this debugging information.\n\n    $ strip target/release/my_application\n\nSee your local `strip` manpage for more information and flags that can be used to specify what information gets stripped out from the binary.\n\n### Allowlist config\n\nYou can also reduce the application size with the `allowlist` config, and only enabling what you need. Sometimes this is useful with Tauri's [Bridge-Pattern](/docs/usage/patterns/bridge) or others, depending on needs.\n\nFor example in `tauri.conf.json` file:\n\n```json\n{\n  \"tauri\": {\n    \"allowlist\": {\n      \"all\": false,\n      \"fs\": {\n        \"writeFile\": true,\n        \"writeBinaryFile\": true\n      },\n      \"shell\": {\n        \"execute\": true\n      },\n      \"dialog\": {\n        \"save\": true\n      }\n    }\n  }\n}\n```\n\n### UPX\n\nUPX, **Ultimate Packer for eXecutables**, is a dinosaur amongst the binary packers. This 23-year old, well-maintained piece of kit is GPL-v2 licensed with a pretty liberal usage declaration. Our understanding of the licensing is that you can use it for any purposes (commercial or otherwise) without needing to change your license unless you modify the source code of UPX.\n\nBasically it compresses the binary and decompresses it at runtime. It should work for pretty much any binary type out there. Read more: https://github.com/upx/upx\n\n<Alert type=\"warning\" title=\"Warning\" icon=\"alert\">\nYou should know that this technique might flag your binary as a virus on Windows and macOS - so use at your own discretion, and as always validate with [Frida](https://frida.re/docs/home/) and do real distribution testing!\n</Alert>\n\n#### Usage on macOS\n\n    $ brew install upx\n    $ yarn tauri build\n    $ upx --ultra-brute src-tauri/target/release/bundle/macos/app.app/Contents/macOS/app\n                           Ultimate Packer for eXecutables\n                              Copyright (C) 1996 - 2018\n    UPX 3.95        Markus Oberhumer, Laszlo Molnar & John Reiser   Aug 26th 2018\n\n            File size         Ratio      Format      Name\n       --------------------   ------   -----------   -----------\n        963140 ->    274448   28.50%   macho/amd64   app\n","h1":[],"h2":[],"h3":[{"content":"Rust Compression Features","type":"text"},{"content":"Stripping","type":"text"},{"content":"Allowlist config","type":"text"},{"content":"UPX","type":"text"}],"hasCodeBlock":true,"programmingLanguages":[null,"json"],"otherSymbols":["text","list","inlineCode","h4","link","strong"]}